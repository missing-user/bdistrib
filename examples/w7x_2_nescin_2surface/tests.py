#!/usr/bin/env python

# This python script checks the output file for an example to 
# see if the results are close to expected values.  This script may be
# run directly, and it is also called when "make test" is run from the
# main BDISTRIB directory.

execfile('../testsCommon.py')

desiredTolerance = 0.04

numFailures = 0

f = readOutputFile()

variableName = 'svd_s_transferMatrix'
data = f.variables[variableName][()]

# The values below come from the 3-surface calculation:

numFailures += arrayShouldBe(variableName, data[0,:], [ \
    0.756733254860545, 0.675471379935325, 0.592208082776024, 0.536884314491204, \
    0.474304119351931, 0.462098639867155, 0.433482824297775,                  \
    0.40504994884439, 0.395088147190296, 0.378002092760559,                   \
    0.369656715956196, 0.342207626946678, 0.334627287931473,                  \
    0.326824776683514, 0.312355089619126, 0.305712027752294,                  \
    0.303350926663656, 0.301176678648187, 0.288128914891327,                  \
    0.280034577096307, 0.271637554610589, 0.260085538016223,                  \
    0.255616286279376, 0.249876146892238, 0.238192304700215,                  \
    0.236560321655081, 0.232465413279583, 0.22713070948282,\
    0.223403714113285, 0.214384017945438, 0.207502997168413,\
    0.204558209532573, 0.202011396131647, 0.191883508432243,\
    0.191195437311696, 0.188523581665167, 0.185294690111036,\
    0.183021274151814, 0.181595026252907, 0.176489218870481,\
    0.174245957077496, 0.17147739256897, 0.166679705693966,\
    0.162844306749977, 0.158286618934456, 0.156019804359829,\
    0.15321023536068, 0.152966798942799, 0.145579688757855,\
    0.144129681784407, 0.141802200925138, 0.140749074973194,\
    0.137454619505406, 0.134086229167065, 0.129633691351194,\
    0.129045270546725, 0.128149070920244, 0.124699505325093,\
    0.123753641386098, 0.1232247541237, 0.120074130931104, 0.117355152256945,\
    0.115289984755215, 0.111710173770693, 0.110884580440802,\
    0.110212806192446, 0.106835826730751, 0.105513704177791,\
    0.103898090212931, 0.100353060501615, 0.100072826078872,\
    0.0982677288706806, 0.0972698589158926, 0.0945747032391133,\
    0.0929268392536622, 0.0913662172162728, 0.0900071127718847,\
    0.0887574228776865, 0.085599196725491, 0.0852461926201933,\
    0.084097083662554, 0.0831740683726667, 0.0813099469428992,\
    0.0809564210197215, 0.0786395793267298, 0.0775260568268283,\
    0.0759165587811006, 0.0749048769083686, 0.0736942554462586,\
 ], desiredTolerance, requireSameLength=False)


#numFailures += shouldBe(variableName, data[0,0], 0.500, desiredTolerance)
#numFailures += arrayShouldBe(variableName, data[0,0], 0.500, desiredTolerance)
#numFailures += arrayShouldBe(variableName, data[0,:], 0.500, desiredTolerance, requireSameLength=False)

f.close()
print "Number of failures:",numFailures
exit(numFailures > 0)
